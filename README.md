# iOSSocketStudy
python으로 구현해보았던 Socket통신을 다시한번 iOS로 구현해보아요
소켓이 뭐야?
﻿소켓(Socket)은 네트워크 통신에서 프로세스 간의 통신을 가능하게 하는 인터페이스입니다. 소켓은 네트워크 소프트웨어 개발에 사용되며, 클라이언트와 서버 간의 데이터 교환을 관리합니다.
소켓은 일종의 추상화된 개념으로, 소프트웨어적으로 구현된 통신 엔드포인트입니다. 소켓은 프로그램이 네트워크를 통해 데이터를 송수신할 수 있도록 인터페이스를 제공합니다. 소켓은 네트워크 계층의 상위 계층인 전송 계층에서 사용됩니다.
라고 GPT의 말씀
socket에는 IP주소와 Port번호가 있다.

## 1. TCP : IP와 함께 사용하는 프로토콜

### IP가 데이터 배달을 하고 TCP는  패킷을 추적하고 관리.
데이터를 보낼때 한번에 보내는 것이 아니라 이것을 토막내서 보내는데 이 토막의 단위를 패킷이라고 한다.
데이터가 제대로 갔는지 이 패킷에 번호를 매기고 없어진게 있는지 손상된게 있는지, 목적지에 온 패킷들을 다시 온전한 데이터형식으로 조립하는 것이 TCP의 역할.
서버가 서버소켓을 만들어서 특정 port에서 기다린다. 그리고 클라이언트에서 접속요청이 올때까지 기다림
클라이언트는 서버 IP주소와 포트번호를가지고 소켓을 만들고 서버에 연결요청
서버가 받아들이면 새로운 소켓을 만들어 거기서 통신을 한다.
- 3way- HandShake 방식.
- 서로 데이터를 주고 받을 수 있는 양방향, 일대일 통신.
- 패킷의 순서는 정확히 유지.
- UDP보다 느림. > 응답이 와야 보낼 수 있기에
- 데이터 흐름제어 : 데이터 송신하는곳과 수신하는 곳의 속도가 다를경우 처리속도를 조절하여 수신자의 버퍼 오버플로우 방지
- 혼잡제어 가능 : 패킷이 너무 많아 넘치지 않게 조금만 보낼수 있게 조절.
TCP는 패킷을 받을때마다 ACK를 서버에게 잘받았다고 알려준다.
그런데 수신자가 패킷을 받지 못해 ACK를 못보내거나, 중간에 ACK가 없어진 경우에는 서버는 ACK를 못받앗기에 다시 똑같은 것을 클라이언트에게 보내준다.
위의 과정을 통해 안정성과 신뢰성은 보장이 된다. 하지만 여기서 오는 양날의 검이 있다. CPU의 부담이 커지면서 느려진다는 단점이다. 
### => 그래서 대부분의 TCP는 연속적인 데이터(실시간 영상들)보다는 신뢰성있는 연결에 주로 사용한다.
## 2. UDP(datagram)
데이터그램 단위로 데이터 송수신. 독립적인 단위
마찬가지로 IP와 Port를 통해 연결을 하지만 recv는 없음
- 송신에서 수신까지 논리적 경로가 있는게 아니라 그 데이터그램이 독립적이게 흘러간다. 그래서 실제 보내는 거랑 다르게 도착할수 있다.
- 1:1, 1:M, M:N통신이 가능하다. > send. recv가 아니므로 그냥 막 보내고 막 받을수 있다.
- TCP보다 빠르다.
- 신뢰성이 낮다! 실제 보내느거가 없어질수도 있고 다르게 도착할수도 있어서
그래서 실시간 스트리밍에 주로 사용한다. 왜냐면 조금 데이터가 유실되도 큰 문제가 없기 때문이다. 
마찬가지로 음성이나 화상같은 경우도 데이터 일부 유실되어도 음질이나 화질이 떨어질뿐 크게 영향을 주지 않아 사용한다
--------
## nodejs server
3000번포트로 서버를 열어주고 socketio를 연결해주고 message를 받는 소켓을 열어준다. 그리고 클라이언트로부터 메시지를 받으면 일단 그것을 한번 출력해주고 다시 emit 즉 res를 클라이언트에게 보내준다. 소켓통신이 오래동안 이루어지지않으면 disconnect되는데 그때 끝낫어 연결이라는 것을 표시해준다.
## ios client 
socketviewmodel을 싱글톤으로 만들어주고 생성동시에 socket과 연결을 해준다.
그리고 setupSocketEvents()에서 message를 서버로 부터 기다리고 있도록 한다.
sendMessage함수는 이후 view에서 사용하려고 만들었다.
처음에 messageLabel에는 아무것도 없다. textfield에 값을 입력하고 엔터를 누르게 되면 sendmessage가 호출되고 server에게 보내게 된다. 그 후 서버에서부터 message가 오면. setupSocketEventhandeler 로 부터 메시지를 맏고 updateMessageLabel로 부터 서버로 부터 온 데이터를 messageLabel에 출력해주게 된다
